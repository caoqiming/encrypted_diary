# diary

这是用 golang 实现的新的日志程序

## 旧的数据的迁移

旧的数据每个日记分两个文件存，一个是日期.ifo，是明文存储的元数据，是一个结构体的数据，按二进制存储，具体格式如下。

```cpp
struct diary_info {
	int year;
	int month;
	int day;
	int hour;
	int minute;
	int length;//same as data_length
};
```

长度为固定的 4 \* 6 = 24 bytes ，前面的都是时间很好理解，最后的 length 是 dat 文件的数据长度，现在忘了为啥有这个了。
数据文件是 GB18030 编码的 rc4 加密的。

## 新格式

首先编码不用 GB18030 了，改用 utf-8，加密算法沿用 rc4，储存也没必要分两个了，拿 base64 把密文编码一下然后和 info 一起塞 json 里得了。之前可能是考虑直接按字节存储比较省空间，但实际上日记这玩意也占不了多大空间，无所谓了。时间也没必要分字段存了，直接用时间戳。length 字段没啥用，不要了。

```json
{
  "Info": {
    "Time": 000
  },
  "Data": "xxxxx"
}
```

另外存储可以是一篇一个单独的文件，但是不能再用日期当作名字了，不然一天只能写一篇，倒不是一天一篇少了。主要是前一天要是晚上 0 点过了才写，第二天也得等 0 点过了在写，这一点很恶心。
新的日志用日期和随机生成的字符作为文件名。
